<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Whisper Live Voice-to-Text</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      padding: 30px;
    }

    h1 {
      color: #1a73e8;
      margin-bottom: 10px;
    }

    button {
      padding: 10px 18px;
      font-size: 16px;
      cursor: pointer;
      margin-right: 10px;
    }

    #status {
      margin-top: 15px;
      font-size: 18px;
      color: #1a73e8;
    }

    #live {
      margin-top: 20px;
      font-size: 22px;
      color: #202124;
      min-height: 32px;
    }

    #history {
      margin-top: 25px;
      background: #ffffff;
      padding: 15px;
      border-radius: 8px;
      max-width: 700px;
    }

    .line {
      margin-bottom: 8px;
      color: #333;
    }
  </style>
</head>

<body>

  <h1>🎙 Whisper Live</h1>

  <button onclick="startListening()">Start Listening</button>
  <button onclick="stopListening()">Stop</button>

  <div id="status">Idle</div>
  <div id="live"></div>

  <div id="history"></div>

  <script>
    let polling = false;
    let poller = null;

    async function startListening() {
      if (polling) return;

      try {
        await fetch("http://127.0.0.1:5000/start", { method: "POST" });
        document.getElementById("status").textContent = "🎙 Listening...";
        polling = true;
        poller = setInterval(pollText, 800);
      } catch (err) {
        document.getElementById("status").textContent = "❌ Backend not running";
      }
    }

    function stopListening() {
      polling = false;
      clearInterval(poller);
      document.getElementById("status").textContent = "Stopped";
      document.getElementById("live").textContent = "";
    }

    async function pollText() {
      if (!polling) return;

      try {
        const res = await fetch("http://127.0.0.1:5000/poll");
        const data = await res.json();

        data.results.forEach(text => {
          // Show as live text
          document.getElementById("live").textContent = text;

          // Add to history
          const div = document.createElement("div");
          div.className = "line";
          div.textContent = text;
          document.getElementById("history").appendChild(div);

          // Clear live text shortly after
          setTimeout(() => {
            document.getElementById("live").textContent = "";
          }, 300);
        });
      } catch (err) {
        document.getElementById("status").textContent = "❌ Connection lost";
        stopListening();
      }
    }
  </script>

</body>
</html>
